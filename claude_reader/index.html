<!DOCTYPE html>
<html>
<head>
    <title>Web Book Reader</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <style>
        :root {
            --primary-color: #2D3748;
            --bg-color: #F7FAFC;
            --text-color: #1A202C;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Georgia', serif;
            line-height: 1.7;
        }

        #reader-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            min-height: 100vh;
        }

        #content {
            font-size: 1.2rem;
            padding: 2rem;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        #toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            gap: 1rem;
            z-index: 1000;
        }

        button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        #font-size {
            padding: 0.5rem;
            font-size: 1rem;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        #progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: var(--primary-color);
            transition: width 0.3s;
        }

        .theme-dark {
            --bg-color: #1A202C;
            --text-color: #E2E8F0;
        }

        #bookmark-indicator {
            position: absolute;
            right: 0;
            width: 4px;
            height: 40px;
            background: #E53E3E;
            transition: top 0.3s;
        }
    </style>
</head>
<body>
    <div id="progress"></div>
    <div id="reader-container">
        <div id="bookmark-indicator"></div>
        <div id="content">
            <!-- Sample content -->
            <h1>Sample Chapter</h1>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            <!-- Add more paragraphs here -->
        </div>
    </div>
    <div id="toolbar">
        <button id="save-pos">Save Position</button>
        <button id="goto-pos">Go to Saved</button>
        <select id="font-size">
            <option value="1">Small</option>
            <option value="1.2" selected>Medium</option>
            <option value="1.4">Large</option>
            <option value="1.6">Extra Large</option>
        </select>
        <button id="theme-toggle">Toggle Theme</button>
    </div>

    <script>
        const content = document.getElementById('content');
        const progress = document.getElementById('progress');
        const savePos = document.getElementById('save-pos');
        const gotoPos = document.getElementById('goto-pos');
        const fontSelect = document.getElementById('font-size');
        const themeToggle = document.getElementById('theme-toggle');
        const bookmarkIndicator = document.getElementById('bookmark-indicator');

        // Progress bar
        function updateProgress() {
            const scrolled = window.scrollY;
            const height = document.documentElement.scrollHeight - window.innerHeight;
            const width = (scrolled / height) * 100;
            progress.style.width = `${width}%`;
        }

        window.addEventListener('scroll', _.throttle(updateProgress, 100));

        // Save and restore position
        savePos.addEventListener('click', () => {
            const pos = window.scrollY;
            localStorage.setItem('reader-position', pos);
            bookmarkIndicator.style.top = `${pos}px`;
            bookmarkIndicator.style.opacity = '1';
        });

        gotoPos.addEventListener('click', () => {
            const pos = localStorage.getItem('reader-position');
            if (pos) {
                window.scrollTo({
                    top: parseInt(pos),
                    behavior: 'smooth'
                });
            }
        });

        // Font size control
        fontSelect.addEventListener('change', (e) => {
            content.style.fontSize = `${e.target.value}rem`;
        });

        // Theme toggle
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('theme-dark');
        });

        // Restore last position on load
        window.addEventListener('load', () => {
            const pos = localStorage.getItem('reader-position');
            if (pos) {
                window.scrollTo(0, parseInt(pos));
                bookmarkIndicator.style.top = `${pos}px`;
                bookmarkIndicator.style.opacity = '1';
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 's' && e.ctrlKey) {
                e.preventDefault();
                savePos.click();
            } else if (e.key === 'g' && e.ctrlKey) {
                e.preventDefault();
                gotoPos.click();
            }
        });
    </script>
</body>
</html>